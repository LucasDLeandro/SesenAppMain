{% extends "ordens/base_ordens.html" %}

{% load widget_tweaks %}

{% block title %} Otis - Lista OS's {% endblock %}



{% block app_content %}
<div class="container-fluid mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold m-0">Ordens de Serviço</h2>
        <a href="{% url 'ordens:create_os' %}" class="btn btn-success shadow-sm">
            <i class="bi bi-plus-lg me-2"></i>Solicitar Serviço
        </a>
    </div>

    <div class="custom-card mb-4">
        <h4 class="mb-4 custom-form-label">Filters</h4>
        <form method="get" class="row g-3">
            {% for field in filter.form %}
            <div class="col-md-4 col-sm-6">
                <label for="{{ field.id_for_label }}" class="form-label custom-form-label">{{ field.label }}</label>
                {{ field|add_class:"form-control" }}
            </div>
            {% endfor %}
            <div class="col-12 mt-4">
                <button type="submit" class="btn btn-primary me-2">
                    <i class="bi bi-search me-2"></i>Pesquisar
                </button>
                <a href="{% url 'ordens:list_os' %}" class="btn btn-outline-secondary">Limpar</a>
            </div>
        </form>
    </div>

    <div class="custom-card">
        <div class="table-responsive">
            <table class="table custom-table table-borderless align-middle">
                <thead>
                    <tr>
                        <th scope="col">Data/Hora</th>
                        <th scope="col">Elevador</th>
                        <th scope="col">Ocorrência</th>
                        <th scope="col">Aprisionamento?</th>
                        <th scope="col">Protocolo</th>
                        <th scope="col">Atendente</th>
                        <th scope="col">Status</th>
                        <th scope="col">Ações</th> {# Nova coluna para ações #}
                    </tr>
                </thead>
                <tbody>
                    {% for os in service_orders %}
                    <tr>
                        <td class="text-nowrap">{{ os.data_hora|date:"d/m/Y H:i" }}</td>
                        <td><span class="badge bg-secondary">{{ os.elevador }}</span></td>
                        <td>{{ os.ocorrencia|truncatechars:40 }}</td>
                        <td>
                            {% if os.aprisionamento %}
                                <span class="badge bg-danger">Sim</span>
                            {% else %}
                                <span class="badge bg-light text-dark">Não</span> {# No modo dark, o bg-light fica escuro, então o text-dark se destaca #}
                            {% endif %}
                        </td>
                        <td><code>{{ os.protocolo }}</code></td>
                        <td>{{ os.atendente }}</td>
                        <td>
                            {% if os.status == 'Concluído' %}
                                <span class="badge bg-success">Concluído</span>
                            {% elif os.status == 'Em Andamento' %}
                                <span class="badge bg-warning">Em Andamento</span>
                            {% else %}
                                <span class="badge bg-secondary">{{ os.status }}</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="#" class="btn btn-sm btn-primary">
                                <i class="bi bi-pencil-square"></i> Editar
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="8" class="text-center py-4">Nenhuma ordem de serviço encontrada.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}